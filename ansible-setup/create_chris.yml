- name: Configure administrative user chris
  hosts: droplet
  become: true
  tasks:

    - name: Ensure user chris exists
      ansible.builtin.user:
        name: chris
        shell: /bin/bash
        groups: wheel
        append: true
        create_home: true

    - name: Create .ssh directory for chris
      ansible.builtin.file:
        path: /home/chris/.ssh
        state: directory
        owner: chris
        group: chris
        mode: '0700'

    - name: Add SSH public key for chris
      ansible.builtin.copy:
        src: ~/.ssh/id_ed25519_do.pub
        dest: /home/chris/.ssh/authorized_keys
        owner: chris
        group: chris
        mode: '0600'

    - name: Allow wheel group passwordless sudo
      ansible.builtin.lineinfile:
        dest: /etc/sudoers
        regexp: '^%wheel'
        line: '%wheel ALL=(ALL) NOPASSWD: ALL'
        validate: 'visudo -cf %s'
